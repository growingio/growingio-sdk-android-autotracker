// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    ext {
        buildConfiguration = [
                compileVersion     : 30,
                minSdkVersion      : 17,
                targetSdkVersion   : 30,
                sourceCompatibility: JavaVersion.VERSION_1_8,
                targetCompatibility: JavaVersion.VERSION_1_8,
        ]

        releaseConfiguration = [
                releaseVersion    : "3.3.4",
                releaseVersionCode: 30304,
        ]

        versions = [
                'gradleTool': '4.2.2',
        ]
        libraries = [
                android    : [
                        'gradle_plugin'      : "com.android.tools.build:gradle:3.3.0",
                        'annotations'        : 'com.android.support:support-annotations:28.0.0',
                        'appcompat'          : 'com.android.support:appcompat-v7:28.0.0',
                        'recyclerview'       : 'com.android.support:recyclerview-v7:28.0.0',
                        'fragment'           : 'com.android.support:support-fragment:28.0.0',
                        'constraint'         : 'com.android.support.constraint:constraint-layout:2.0.1',
                        'multidex'           : 'com.android.support:multidex:1.0.3',
                        'navigation_fragment': 'android.arch.navigation:navigation-fragment:1.0.0',
                        'navigation_ui'      : 'android.arch.navigation:navigation-ui:1.0.0',
                        'livedata'           : 'android.arch.lifecycle:livedata:1.1.1',
                        'viewmodel'          : 'android.arch.lifecycle:viewmodel:1.1.1',
                        'volley'             : 'com.android.volley:volley:1.2.0',
                ],

                'androidx' : [
                        'appcompat'   : 'androidx.appcompat:appcompat:1.0.0',
                        'fragment'    : 'androidx.fragment:fragment:1.0.0',
                        'recyclerview': 'androidx.recyclerview:recyclerview:1.0.0',
                ],

                'growingio': [
                        'gmonitor'        : 'com.growingio.android:gmonitor:1.5.0',
                        'tracker_core'    : "com.growingio.android:tracker-core:$releaseConfiguration.releaseVersion",
                        'tracker'         : "com.growingio.android:tracker:$releaseConfiguration.releaseVersion",
                        'tracker_cdp'     : "com.growingio.android:tracker-cdp:$releaseConfiguration.releaseVersion",
                        'autotracker_core': "com.growingio.android:autotracker-core:$releaseConfiguration.releaseVersion",
                        'autotracker'     : "com.growingio.android:autotracker:$releaseConfiguration.releaseVersion",
                        'autotracker_cdp' : "com.growingio.android:autotracker-cdp:$releaseConfiguration.releaseVersion",
                        'annotation'      : "com.growingio.android:annotation:$releaseConfiguration.releaseVersion",
                        'compiler'        : "com.growingio.android:compiler:$releaseConfiguration.releaseVersion",

                        'hybrid'          : "com.growingio.android:hybrid:$releaseConfiguration.releaseVersion",
                        'okhttp3'         : "com.growingio.android:okhttp3:$releaseConfiguration.releaseVersion",
                        'database'        : "com.growingio.android:database:$releaseConfiguration.releaseVersion",
                        'volley'          : "com.growingio.android:volley:$releaseConfiguration.releaseVersion",
                        'urlconnection'   : "com.growingio.android:urlconnection:$releaseConfiguration.releaseVersion",
                        'debugger'        : "com.growingio.android:debugger:$releaseConfiguration.releaseVersion",
                        'circler'         : "com.growingio.android:circler:$releaseConfiguration.releaseVersion",
                        'json'            : "com.growingio.android:json:$releaseConfiguration.releaseVersion",
                        'protobuf'        : "com.growingio.android:protobuf:$releaseConfiguration.releaseVersion",
                        'encoder'         : "com.growingio.android:encoder:$releaseConfiguration.releaseVersion",
                        'crash'           : "com.growingio.android:crash:$releaseConfiguration.releaseVersion",
                        'oaid'            : "com.growingio.android:oaid:$releaseConfiguration.releaseVersion",
                        'snappy'          : "com.growingio.android:snappy:1.1.0",
                ],

                'google'   : [
                        'auto_service'            : 'com.google.auto.service:auto-service:1.0-rc7',
                        'auto_service_annotations': 'com.google.auto.service:auto-service-annotations:1.0-rc7',

                        'protobuf_gradle_plugin'  : 'com.google.protobuf:protobuf-gradle-plugin:0.8.17',
                        'protobuf_java'           : 'com.google.protobuf:protobuf-java:3.19.1',
                        'protobuf_javalite'       : 'com.google.protobuf:protobuf-javalite:3.19.1',
                        'protobufc'               : 'com.google.protobuf:protoc:3.9.1',
                        'protobuf_java_util'      : 'com.google.protobuf:protobuf-java-util:3.19.1',
                ],

                'squareup' : [
                        'javapoet': 'com.squareup:javapoet:1.13.0',
                        'okhttp3' : 'com.squareup.okhttp3:okhttp:3.12.1',
                ],

                'others'   : [
                        'x5_webview': 'com.tencent.tbs.tbssdk:sdk:43903',
                ],

                'test'     : [
                        'junit'                         : 'junit:junit:4.13',
                        'androidx_core'                 : 'androidx.test:core:1.3.0',
                        'androidx_runner'               : 'androidx.test:runner:1.3.0',
                        'androidx_rules'                : 'androidx.test:rules:1.3.0',
                        'androidx_truth'                : 'androidx.test.ext:truth:1.3.0',
                        'androidx_fragment'             : 'androidx.fragment:fragment-testing:1.3.0',
                        'androidx_junit'                : 'androidx.test.ext:junit:1.1.2',
                        'robolectric'                   : "org.robolectric:robolectric:4.5.1",
                        'espresso_core'                 : 'androidx.test.espresso:espresso-core:3.3.0',
                        'espresso_web'                  : 'androidx.test.espresso:espresso-web:3.3.0',
                        'orchestrator'                  : 'androidx.test:orchestrator:1.3.0',
                        'mockito_core'                  : 'org.mockito:mockito-core:2.24.0',
                        'powermock_core'                : 'org.powermock:powermock-core:2.0.9',
                        'powermock_api_mockito2'        : 'org.powermock:powermock-api-mockito2:2.0.9',
                        'powermock_module_junit4'       : 'org.powermock:powermock-module-junit4:2.0.9',
                        'powermock_module_junit4_rule'  : 'org.powermock:powermock-module-junit4-rule:2.0.9',
                        'powermock_classloading_xstream': 'org.powermock:powermock-classloading-xstream:2.0.9',
                        'powermock_reflect'             : 'org.powermock:powermock-reflect:2.0.9',
                        'truth'                         : 'com.google.truth:truth:1.0',
                        'compile_testing'               : 'com.google.testing.compile:compile-testing:0.18',
                        'okhttp3_mockwebserver'         : 'com.squareup.okhttp3:mockwebserver:3.12.1',
                        'awaitility'                    : 'org.awaitility:awaitility:4.0.3',
                ],

                'sonar'    : [
                        'sonar': 'org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:3.1.1',
                ],

                'asm'      : [
                        'asm'        : 'org.ow2.asm:asm:9.1',
                        'asm_commons': 'org.ow2.asm:asm-commons:9.1',
                        'asm_util'   : 'org.ow2.asm:asm-util:9.1',
                        'asm_tree'   : 'org.ow2.asm:asm-tree:9.1',
                ],
        ]
        kotlin_version = '1.4.32'
    }

    repositories {
        mavenLocal()
        mavenCentral()
        maven { url "https://s01.oss.sonatype.org/content/repositories/snapshots/" }
        google()
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {
        classpath "com.android.tools.build:gradle:${versions.gradleTool}"
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath "io.codearte.gradle.nexus:gradle-nexus-staging-plugin:0.30.0"
        classpath libraries.google.protobuf_gradle_plugin
        classpath libraries.sonar.sonar
    }
}

apply from: "${rootProject.projectDir}/gradle/sonarcloud.gradle"

allprojects {
    repositories {
        mavenLocal()
        mavenCentral()
        maven { url "https://s01.oss.sonatype.org/content/repositories/snapshots/" }
        google()
    }
}

apply from: "${rootProject.projectDir}/gradle/stagingMaven.gradle"

subprojects { project ->
    apply plugin: 'checkstyle'

    task checkstyle(type: Checkstyle, group: 'check') {
        configFile file("${rootDir}/config/checkstyle/checkstyle.xml")
        configProperties.checkstyleJavaHeader = file("${rootDir}/config/checkstyle/java.header")
        source 'src/main/java', 'src/test/java', 'src/androidTest/java'
        ignoreFailures false
        showViolations true
        include '**/*.java'
        classpath = files()
    }

    afterEvaluate {
        if (project.tasks.findByName('check')) {
            check.dependsOn('checkstyle')
        }
    }
}